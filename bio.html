<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bio — nightbio.lol</title>
  <meta name="description" content="">
  <meta property="og:title" content="">
  <meta property="og:description" content="">
  <meta property="og:image" content="">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="">
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="bio-page">
  <div class="bg-gradient"></div>
  <div class="bg-grid"></div>
  <div class="bio-bg-blur-cover" id="bioBgBlurCover" aria-hidden="true"></div>

  <main class="page" id="bioMain">
    <div id="bioContent" style="display: none;">
      <img id="bioBanner" class="bio-banner" src="" alt="">
      <div class="bio-profile">
        <img id="bioAvatar" class="bio-avatar" src="" alt="" style="display: none;">
        <h1 id="bioName" class="bio-name"></h1>
        <p id="bioAlsoKnownAs" class="bio-alias" style="display: none;"></p>
        <div id="bioBadges" class="bio-badges"></div>
        <p id="bioBio" class="bio-bio-text"></p>
        <p id="bioViews" class="bio-views" style="display: none;"></p>
        <div id="bioSongWrap" class="bio-song-wrap" style="display: none;"></div>
        <div id="bioLinks" class="bio-links"></div>
      </div>
    </div>
    <div id="bioLoading" class="bio-404">
      <p>Loading…</p>
    </div>
    <div id="bio404" class="bio-404" style="display: none;">
      <h1>Bio not found</h1>
      <p>This user doesn't exist or hasn't set up their bio yet.</p>
      <a href="index">Back to nightbio</a>
    </div>
  </main>

  <footer class="bio-footer">
    <a href="index">nightbio.lol</a>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="auth.js"></script>
  <script src="maintenance.js"></script>
  <script src="badge-icons.js"></script>
  <script src="link-icons.js"></script>
  <script src="bio.js"></script>
  <script>
    (function() {

      function setMetaTags(data) {
        var title = (data.metaTitle && data.metaTitle.trim()) ? data.metaTitle.trim() : ((data.displayName || data.username) || 'Bio') + ' — nightbio.lol';
        var descRaw = (data.metaDescription && data.metaDescription.trim()) ? data.metaDescription.trim() : (data.bio || '');
        var desc = descRaw.replace(/\s+/g, ' ').trim().slice(0, 200);
        var imgRaw = (data.metaImageURL && data.metaImageURL.trim()) ? data.metaImageURL.trim() : (data.avatarURL || data.bannerURL || '');
        var origin = (typeof window !== 'undefined' && window.location && window.location.origin) ? window.location.origin : 'https://nightbio.lol';
        var img = imgRaw ? (imgRaw.indexOf('http') === 0 ? imgRaw : (imgRaw.indexOf('/') === 0 ? origin + imgRaw : origin + '/' + imgRaw)) : '';
        var pageUrl = (typeof window !== 'undefined' && window.location && window.location.href) ? window.location.href : (origin + '/bio');
        document.title = title;
        var metaDesc = document.querySelector('meta[name="description"]');
        if (metaDesc) metaDesc.setAttribute('content', desc);
        var ogTitle = document.querySelector('meta[property="og:title"]');
        if (ogTitle) ogTitle.setAttribute('content', title);
        var ogDesc = document.querySelector('meta[property="og:description"]');
        if (ogDesc) ogDesc.setAttribute('content', desc);
        var ogImg = document.querySelector('meta[property="og:image"]');
        if (ogImg) ogImg.setAttribute('content', img);
        var ogUrl = document.querySelector('meta[property="og:url"]');
        if (!ogUrl) {
          ogUrl = document.createElement('meta');
          ogUrl.setAttribute('property', 'og:url');
          document.head.appendChild(ogUrl);
        }
        ogUrl.setAttribute('content', pageUrl);
        var ogType = document.querySelector('meta[property="og:type"]');
        if (!ogType) {
          ogType = document.createElement('meta');
          ogType.setAttribute('property', 'og:type');
          document.head.appendChild(ogType);
        }
        ogType.setAttribute('content', 'website');
        var twTitle = document.querySelector('meta[name="twitter:title"]');
        if (twTitle) twTitle.setAttribute('content', title);
        var twDesc = document.querySelector('meta[name="twitter:description"]');
        if (twDesc) twDesc.setAttribute('content', desc);
        var twImg = document.querySelector('meta[name="twitter:image"]');
        if (twImg) twImg.setAttribute('content', img);
      }

      function loadFont(fontFamily) {
        if (!fontFamily || typeof fontFamily !== 'string') return;
        var familyParam = fontFamily.replace(/\s+/g, '+');
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://fonts.googleapis.com/css2?family=' + familyParam + ':wght@400;500;600;700&display=swap';
        document.head.appendChild(link);
      }

      function typewriterEffect(el, text, speed) {
        if (!el || text === '') return;
        el.textContent = '';
        el.style.display = 'block';
        var i = 0;
        function type() {
          if (i < text.length) {
            el.textContent += text.charAt(i);
            i++;
            setTimeout(type, speed);
          }
        }
        type();
      }

      // Custom tooltip (hover/focus) for public bio
      var _nbTooltip = null;
      var _nbTooltipActiveEl = null;
      function ensureTooltip() {
        if (_nbTooltip) return _nbTooltip;
        var t = document.createElement('div');
        t.id = 'nbTooltip';
        t.className = 'nb-tooltip';
        t.setAttribute('role', 'tooltip');
        t.setAttribute('aria-hidden', 'true');
        document.body.appendChild(t);
        _nbTooltip = t;
        return t;
      }
      function setTooltipPos(x, y) {
        var t = ensureTooltip();
        var pad = 12;
        var rect = t.getBoundingClientRect();
        var left = x + 12;
        var top = y + 12;
        var maxLeft = Math.max(pad, (window.innerWidth || 0) - rect.width - pad);
        var maxTop = Math.max(pad, (window.innerHeight || 0) - rect.height - pad);
        if (left > maxLeft) left = x - rect.width - 12;
        if (top > maxTop) top = y - rect.height - 12;
        left = Math.min(maxLeft, Math.max(pad, left));
        top = Math.min(maxTop, Math.max(pad, top));
        t.style.left = left + 'px';
        t.style.top = top + 'px';
      }
      function showTooltip(el, text, x, y) {
        if (!el || !text) return;
        var t = ensureTooltip();
        _nbTooltipActiveEl = el;
        t.textContent = text;
        t.style.display = 'block';
        t.setAttribute('aria-hidden', 'false');
        // Position after content so rect is accurate
        setTooltipPos(x, y);
        t.classList.add('show');
      }
      function hideTooltip() {
        if (!_nbTooltip) return;
        _nbTooltipActiveEl = null;
        _nbTooltip.classList.remove('show');
        _nbTooltip.setAttribute('aria-hidden', 'true');
        // keep in DOM for reuse
      }
      function getTooltipTarget(node) {
        if (!node || !node.closest) return null;
        return node.closest('[data-tooltip]');
      }
      document.addEventListener('mousemove', function(ev) {
        if (!_nbTooltipActiveEl || !_nbTooltip || !_nbTooltip.classList.contains('show')) return;
        setTooltipPos(ev.clientX, ev.clientY);
      }, { passive: true });
      document.addEventListener('mouseover', function(ev) {
        var target = getTooltipTarget(ev.target);
        if (!target) return;
        var text = target.getAttribute('data-tooltip') || '';
        if (!text) return;
        showTooltip(target, text, ev.clientX, ev.clientY);
      });
      document.addEventListener('mouseout', function(ev) {
        var rel = ev.relatedTarget;
        if (_nbTooltipActiveEl && rel && _nbTooltipActiveEl.contains(rel)) return;
        hideTooltip();
      });
      document.addEventListener('focusin', function(ev) {
        var target = getTooltipTarget(ev.target);
        if (!target) return;
        var text = target.getAttribute('data-tooltip') || '';
        if (!text) return;
        var r = target.getBoundingClientRect();
        showTooltip(target, text, r.left + r.width / 2, r.top);
      });
      document.addEventListener('focusout', function() { hideTooltip(); });
      window.addEventListener('scroll', function() { hideTooltip(); }, { passive: true });

      initFirebase();

      var params = new URLSearchParams(window.location.search);
      var username = params.get('u');
      var content = document.getElementById('bioContent');
      var loading = document.getElementById('bioLoading');
      var notFound = document.getElementById('bio404');

      function hideAll() {
        content.style.display = 'none';
        loading.style.display = 'none';
        notFound.style.display = 'none';
      }
      function showLoading() {
        hideAll();
        loading.style.display = 'block';
      }
      function showNotFound() {
        hideAll();
        notFound.style.display = 'block';
      }
      function showBio(data) {
        hideAll();
        content.style.display = 'block';

        setMetaTags(data);
        if (data.uid) recordProfileView(data.uid);

        var layout = data.layout || 'classic';
        var fontFamily = data.fontFamily || 'Outfit';
        var fontSize = data.fontSize != null ? data.fontSize : 16;
        var letterSpacing = data.letterSpacing != null ? data.letterSpacing : 0;
        var buttonStyle = data.buttonStyle || 'filled';
        var bgEffect = data.backgroundEffect || 'none';

        var premium = !!data.hasPremium;
        document.body.classList.toggle('bio-display-card', data.displayStyle === 'card');
        var mainEl = document.getElementById('bioMain');
        if (mainEl) {
          if (data.displayStyle === 'card') {
            mainEl.style.width = (data.cardWidth != null && data.cardWidth >= 260 && data.cardWidth <= 800) ? (data.cardWidth + 'px') : '';
            mainEl.style.minWidth = (data.cardWidth != null && data.cardWidth >= 260 && data.cardWidth <= 800) ? (data.cardWidth + 'px') : '';
            mainEl.style.height = (data.cardHeight != null && data.cardHeight >= 0 && data.cardHeight <= 1200) ? (data.cardHeight + 'px') : '';
            mainEl.style.minHeight = '';
            var modalOpacityVal = (data.modalOpacity != null ? Math.min(100, Math.max(0, data.modalOpacity)) : 96) / 100;
            mainEl.style.setProperty('--modal-opacity', String(modalOpacityVal));
            mainEl.style.setProperty('--modal-blur', String(Math.min(24, Math.max(0, data.modalBlur != null ? data.modalBlur : 0))) + 'px');
            mainEl.style.setProperty('--modal-border-opacity', String((data.modalBorderOpacity != null ? Math.min(100, Math.max(0, data.modalBorderOpacity)) : 20) / 100));
            mainEl.style.setProperty('--modal-radius', String(Math.min(32, Math.max(8, data.modalRadius != null ? data.modalRadius : 24))) + 'px');
            function hexToRgba(hex, a) {
              var m = (hex || '').match(/^#?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);
              if (!m) return '';
              return 'rgba(' + parseInt(m[1], 16) + ',' + parseInt(m[2], 16) + ',' + parseInt(m[3], 16) + ',' + a + ')';
            }
            if (data.modalUseGradient && data.modalGradientColor1 && data.modalGradientColor2 && /^#[0-9A-Fa-f]{6}$/.test(data.modalGradientColor1) && /^#[0-9A-Fa-f]{6}$/.test(data.modalGradientColor2)) {
              mainEl.style.background = 'linear-gradient(180deg, ' + hexToRgba(data.modalGradientColor1, modalOpacityVal) + ', ' + hexToRgba(data.modalGradientColor2, modalOpacityVal) + ')';
            } else {
              var cardColor = (data.modalBackgroundColor && /^#[0-9A-Fa-f]{6}$/.test(String(data.modalBackgroundColor))) ? data.modalBackgroundColor : '#12121a';
              mainEl.style.background = hexToRgba(cardColor, modalOpacityVal);
            }
          } else {
            mainEl.style.removeProperty('--modal-opacity');
            mainEl.style.removeProperty('--modal-blur');
            mainEl.style.removeProperty('--modal-border-opacity');
            mainEl.style.removeProperty('--modal-radius');
            mainEl.style.background = '';
            mainEl.style.width = '';
            mainEl.style.minWidth = '';
            mainEl.style.height = '';
            mainEl.style.minHeight = '';
          }
        }
        if (premium && data.premiumCustomFontFamily && data.premiumCustomFontFamily.trim()) {
          fontFamily = data.premiumCustomFontFamily.trim();
        }
        var profileAlign = (data.profileAlignment === 'left' || data.profileAlignment === 'right') ? data.profileAlignment : 'center';
        content.className = 'bio-content-wrap bio-layout-' + layout + ' bio-align-' + profileAlign + ' bio-btn-' + buttonStyle +
          (premium && data.premiumButtonShape ? ' bio-premium-btn-' + data.premiumButtonShape : '') +
          (premium && data.premiumLinkHoverEffect ? ' bio-premium-hover-' + data.premiumLinkHoverEffect : '') +
          (premium && data.premiumLayoutPreset ? ' bio-premium-layout-' + data.premiumLayoutPreset : '') +
          (premium && data.premiumProfileAnimation ? ' bio-premium-anim-' + data.premiumProfileAnimation : '') +
          (premium && data.premiumUsernameEffect ? ' bio-username-effect-' + data.premiumUsernameEffect : '') +
          (premium && data.premiumGlowUsername ? ' bio-glow-username' : '') +
          (premium && data.premiumGlowSocials ? ' bio-glow-socials' : '') +
          (premium && data.premiumGlowBadges ? ' bio-glow-badges' : '') +
          (premium && data.premiumGlowBio ? ' bio-glow-bio' : '') +
          (premium && data.premiumMonochromeBadges ? ' bio-badges-monochrome' : '');
        document.body.classList.remove('bio-bg-none', 'bio-bg-gradient', 'bio-bg-pattern', 'bio-bg-snowflakes', 'bio-bg-rain');
        document.body.classList.add('bio-bg-' + (bgEffect === 'none' ? 'none' : bgEffect));
        document.body.classList.remove('bio-bg-effect-blurred', 'bio-bg-effect-snowflakes', 'bio-bg-effect-rain');
        var bgEffectPremium = (premium && (data.premiumBackgroundEffect === 'blurred' || data.premiumBackgroundEffect === 'snowflakes' || data.premiumBackgroundEffect === 'rain')) ? data.premiumBackgroundEffect : '';
        if (bgEffectPremium === 'blurred') document.body.classList.add('bio-bg-effect-blurred');
        if (bgEffectPremium === 'snowflakes') document.body.classList.add('bio-bg-effect-snowflakes');
        if (bgEffectPremium === 'rain') document.body.classList.add('bio-bg-effect-rain');
        if (bgEffect === 'snowflakes' || bgEffect === 'rain') document.body.classList.add('bio-bg-effect-' + bgEffect);
        var blurCoverEl = document.getElementById('bioBgBlurCover');
        if (blurCoverEl) {
          if (bgEffectPremium === 'blurred') {
            var blurImgUrl = (data.bannerURL && data.bannerURL.trim()) ? data.bannerURL.trim() : ((data.avatarURL && data.avatarURL.trim()) ? data.avatarURL.trim() : '');
            if (blurImgUrl) {
              blurCoverEl.style.backgroundImage = 'url(' + blurImgUrl.replace(/["\\]/g, '') + ')';
              blurCoverEl.classList.add('bio-bg-blur-cover-visible');
            } else {
              blurCoverEl.style.backgroundImage = '';
              blurCoverEl.classList.remove('bio-bg-blur-cover-visible');
            }
          } else {
            blurCoverEl.style.backgroundImage = '';
            blurCoverEl.classList.remove('bio-bg-blur-cover-visible');
          }
        }
        var oldParticles = document.getElementById('bioParticleEffect');
        if (oldParticles && oldParticles.parentNode) oldParticles.remove();
        var useSnowflakes = (bgEffect === 'snowflakes') || (premium && data.premiumBackgroundEffect === 'snowflakes');
        var useRain = (bgEffect === 'rain') || (premium && data.premiumBackgroundEffect === 'rain');
        if (useSnowflakes || useRain) {
          var particleWrap = document.createElement('div');
          particleWrap.id = 'bioParticleEffect';
          particleWrap.className = 'bio-particle-effect';
          var count = useSnowflakes ? 35 : 50;
          for (var i = 0; i < count; i++) {
            var el = document.createElement('div');
            el.className = useSnowflakes ? 'bio-snowflake' : 'bio-raindrop';
            el.style.left = (Math.random() * 100) + '%';
            el.style.animationDuration = (useSnowflakes ? (4 + Math.random() * 4) : (0.8 + Math.random() * 0.6)) + 's';
            el.style.animationDelay = (Math.random() * 5) + 's';
            particleWrap.appendChild(el);
          }
          document.body.insertBefore(particleWrap, document.body.firstChild);
        }
        if (premium && data.premiumVideoBackground && data.premiumVideoBackground.trim()) {
          document.body.classList.add('bio-premium-video-bg');
          var existingVideo = document.getElementById('bioPremiumVideoBg');
          if (existingVideo) existingVideo.remove();
          var vid = document.createElement('video');
          vid.id = 'bioPremiumVideoBg';
          vid.autoplay = true;
          vid.muted = true;
          vid.loop = true;
          vid.playsInline = true;
          vid.style.cssText = 'position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;pointer-events:none;';
          var src = document.createElement('source');
          src.src = data.premiumVideoBackground.trim();
          src.type = 'video/mp4';
          vid.appendChild(src);
          document.body.insertBefore(vid, document.body.firstChild);
        } else {
          document.body.classList.remove('bio-premium-video-bg');
          var oldV = document.getElementById('bioPremiumVideoBg');
          if (oldV) oldV.remove();
        }

        loadFont(fontFamily);
        var fontValue = (fontFamily.indexOf(' ') !== -1) ? ('"' + fontFamily.replace(/"/g, '\\"') + '"') : fontFamily;
        document.body.style.setProperty('--bio-font', fontValue);
        document.body.style.setProperty('--bio-font-size', fontSize + 'px');
        document.body.style.setProperty('--bio-letter-spacing', letterSpacing + 'px');
        if (data.accentColor) document.body.style.setProperty('--purple-accent', data.accentColor);
        var glowColor = (premium && data.premiumGlowColor && /^#[0-9A-Fa-f]{6}$/.test(String(data.premiumGlowColor))) ? String(data.premiumGlowColor) : (data.accentColor && /^#[0-9A-Fa-f]{6}$/.test(String(data.accentColor)) ? data.accentColor : '');
        if (glowColor) content.style.setProperty('--bio-glow-color', glowColor);
        else content.style.removeProperty('--bio-glow-color');
        var glowStrength = (premium && data.premiumGlowStrength != null) ? Math.min(200, Math.max(25, Number(data.premiumGlowStrength) || 100)) : 100;
        var glowS = glowStrength / 100;
        function setGlowBlur(name, basePx) { var v = (basePx * glowS) + 'px'; document.body.style.setProperty('--bio-glow-' + name, v); content.style.setProperty('--bio-glow-' + name, v); }
        setGlowBlur('sm', 4);
        setGlowBlur('md', 6);
        setGlowBlur('lg', 8);
        setGlowBlur('xl', 10);
        setGlowBlur('2xl', 12);
        setGlowBlur('3xl', 14);
        setGlowBlur('4xl', 18);
        setGlowBlur('5xl', 24);
        if (premium) {
          if (data.premiumLinkFontSize != null) content.style.setProperty('--bio-link-font-size', Math.min(24, Math.max(12, data.premiumLinkFontSize)) + 'px');
          if (data.premiumLinkBorderRadius != null) content.style.setProperty('--bio-link-radius', Math.min(50, Math.max(0, data.premiumLinkBorderRadius)) + 'px');
        }

        var banner = document.getElementById('bioBanner');
        var avatar = document.getElementById('bioAvatar');
        var nameEl = document.getElementById('bioName');
        var bioEl = document.getElementById('bioBio');
        var songWrap = document.getElementById('bioSongWrap');
        var linksEl = document.getElementById('bioLinks');

        // Cover image is used as full-page background (not a small banner)
        if (banner) {
          banner.style.display = 'none';
          banner.removeAttribute('src');
        }
        var coverUrl = (data.bannerURL && data.bannerURL.trim()) ? data.bannerURL.trim() : '';
        var coverEl = document.getElementById('bioCoverBg');
        if (!coverUrl) {
          document.body.classList.remove('bio-has-cover-bg');
          if (coverEl) coverEl.remove();
        } else {
          document.body.classList.add('bio-has-cover-bg');
          if (!coverEl) {
            coverEl = document.createElement('div');
            coverEl.id = 'bioCoverBg';
            coverEl.setAttribute('role', 'img');
            coverEl.setAttribute('aria-hidden', 'true');
            coverEl.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:-2;background-size:cover;background-position:center;background-repeat:no-repeat;pointer-events:none;';
            document.body.insertBefore(coverEl, document.body.firstChild);
          }
          coverEl.style.backgroundImage = 'url(' + coverUrl.replace(/["\\]/g, '') + ')';
          if (bgEffectPremium === 'blurred') {
            coverEl.style.display = 'none';
          } else {
            coverEl.style.display = '';
            if (premium && data.premiumBannerBlur > 0) {
              coverEl.style.filter = 'blur(' + Math.min(20, data.premiumBannerBlur) + 'px)';
              coverEl.style.transform = 'scale(1.04)';
            } else {
              coverEl.style.filter = '';
              coverEl.style.transform = '';
            }
          }
        }

        if (data.avatarURL) {
          avatar.src = data.avatarURL;
          avatar.alt = data.displayName || data.username;
          avatar.style.display = 'block';
          if (premium && data.premiumAvatarBorder && data.premiumAvatarBorder.trim()) {
            avatar.style.border = data.premiumAvatarBorder.trim();
          } else {
            avatar.style.border = '';
          }
        } else {
          avatar.style.display = 'none';
          avatar.removeAttribute('src');
        }

        // Premium: 3D tilt parallax on card only when hovering over the card
        if (window._bioParallaxCleanup) { try { window._bioParallaxCleanup(); } catch (e) {} window._bioParallaxCleanup = null; }
        var parallaxOnCard = premium && data.premiumParallax && data.displayStyle === 'card';
        document.body.classList.toggle('bio-premium-parallax', !!parallaxOnCard);
        if (parallaxOnCard && mainEl) {
          var maxDeg = 6;
          function setTilt(rotY, rotX) {
            mainEl.style.setProperty('--nb-tilt-y', rotY + 'deg');
            mainEl.style.setProperty('--nb-tilt-x', rotX + 'deg');
          }
          function onMove(ev) {
            var r = mainEl.getBoundingClientRect();
            var cx = ev.clientX - r.left;
            var cy = ev.clientY - r.top;
            var x = (cx / Math.max(1, r.width)) * 2 - 1;
            var y = (cy / Math.max(1, r.height)) * 2 - 1;
            setTilt((x * maxDeg).toFixed(2), ((-y) * maxDeg).toFixed(2));
          }
          function onEnter() {
            mainEl.addEventListener('mousemove', onMove, { passive: true });
          }
          function onLeave() {
            mainEl.removeEventListener('mousemove', onMove);
            setTilt('0', '0');
          }
          mainEl.addEventListener('mouseenter', onEnter);
          mainEl.addEventListener('mouseleave', onLeave);
          window._bioParallaxCleanup = function() {
            mainEl.removeEventListener('mouseenter', onEnter);
            mainEl.removeEventListener('mouseleave', onLeave);
            mainEl.removeEventListener('mousemove', onMove);
            mainEl.style.removeProperty('--nb-tilt-y');
            mainEl.style.removeProperty('--nb-tilt-x');
          };
        }

        var nameText = data.displayName || data.username || '';
        var existingWrap = document.getElementById('bioNameWrap');
        if (existingWrap && existingWrap.parentNode) {
          existingWrap.parentNode.insertBefore(nameEl, existingWrap);
          existingWrap.remove();
        }
        var existingCheck = document.getElementById('bioVerifiedCheck');
        if (existingCheck) existingCheck.remove();
        if (premium && data.premiumUsernameEffect === 'typewriter') {
          nameEl.textContent = '';
          nameEl.style.display = 'block';
          typewriterEffect(nameEl, nameText, 80);
        } else {
          nameEl.textContent = nameText;
        }
        if (data.showVerifiedCheckmark && data.badges && data.badges.verified) {
          var wrap = document.createElement('span');
          wrap.id = 'bioNameWrap';
          wrap.className = 'bio-name-wrap';
          nameEl.parentNode.insertBefore(wrap, nameEl);
          wrap.appendChild(nameEl);
          var checkSpan = document.createElement('span');
          checkSpan.id = 'bioVerifiedCheck';
          checkSpan.className = 'bio-verified-check';
          checkSpan.setAttribute('aria-hidden', 'true');
          var checkSvg = (window.BADGE_ICONS && window.BADGE_ICONS.checkmark) ? window.BADGE_ICONS.checkmark : '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4"/></svg>';
          checkSpan.innerHTML = checkSvg;
          wrap.appendChild(checkSpan);
        }
        var alsoKnownEl = document.getElementById('bioAlsoKnownAs');
        if (alsoKnownEl) {
          if (data.alias && data.alias.trim()) {
            alsoKnownEl.textContent = 'also known as @' + data.alias.trim();
            alsoKnownEl.style.display = '';
          } else {
            alsoKnownEl.textContent = '';
            alsoKnownEl.style.display = 'none';
          }
        }
        if (premium && data.premiumNameColor && /^#[0-9A-Fa-f]{6}$/.test(String(data.premiumNameColor))) {
          nameEl.style.color = String(data.premiumNameColor).trim();
        } else {
          nameEl.style.color = '';
        }
        if (premium && data.premiumBioColor && /^#[0-9A-Fa-f]{6}$/.test(String(data.premiumBioColor))) {
          bioEl.style.color = String(data.premiumBioColor).trim();
        } else {
          bioEl.style.color = '';
        }
        if (premium && data.premiumBioFontSize != null) {
          bioEl.style.fontSize = Math.min(24, Math.max(12, data.premiumBioFontSize)) + 'px';
        } else {
          bioEl.style.fontSize = '';
        }

        var badgesRow = document.getElementById('bioBadges');
        if (badgesRow) {
          badgesRow.innerHTML = '';
          var badges = data.badges || {};
          var icons = window.BADGE_ICONS || {};
          var labels = { community: 'Community', og: 'OG', owner: 'Owner', staff: 'Staff', verified: 'Verified', premium: 'Premium' };
          var order = ['community', 'verified', 'staff', 'owner', 'og', 'premium'];
          order.forEach(function(key) {
            if (!badges[key]) return;
            var info = (window.BIO_BADGES && window.BIO_BADGES[key]) ? window.BIO_BADGES[key] : null;
            var span = document.createElement('span');
            span.className = 'bio-badge bio-badge-' + key;
            if (premium && data.badgeColors && data.badgeColors[key] && /^#[0-9A-Fa-f]{6}$/.test(String(data.badgeColors[key]))) {
              span.style.color = String(data.badgeColors[key]);
            }
            var tip = (labels[key] || key);
            span.setAttribute('data-tooltip', tip);
            span.setAttribute('tabindex', '0');
            if (icons[key]) {
              var iconWrap = document.createElement('span');
              iconWrap.className = 'bio-badge-icon';
              iconWrap.innerHTML = icons[key];
              span.appendChild(iconWrap);
            }
            badgesRow.appendChild(span);
          });
        }

        if (data.bio) {
          bioEl.style.display = 'block';
          if (premium && data.typewriterBio) {
            bioEl.textContent = data.bio;
            bioEl.style.minHeight = bioEl.offsetHeight + 'px';
            bioEl.textContent = '';
            typewriterEffect(bioEl, data.bio, 35);
          } else {
            bioEl.textContent = data.bio;
          }
        } else {
          bioEl.style.display = 'none';
        }

        var viewsEl = document.getElementById('bioViews');
        if (viewsEl) {
          if (data.showViewsOnBio && data.stats && typeof data.stats.views === 'number') {
            viewsEl.textContent = (data.stats.views || 0).toLocaleString() + ' profile view' + ((data.stats.views || 0) === 1 ? '' : 's');
            viewsEl.style.display = 'block';
            viewsEl.setAttribute('data-tooltip', 'Profile views');
            viewsEl.setAttribute('tabindex', '0');
          } else {
            viewsEl.style.display = 'none';
            viewsEl.textContent = '';
            viewsEl.removeAttribute('data-tooltip');
            viewsEl.removeAttribute('tabindex');
          }
        }

        if (data.songURL && data.songURL.trim()) {
          var url = data.songURL.trim();
          var spotifyMatch = url.match(/open\.spotify\.com\/(track|album|playlist)\/([a-zA-Z0-9]+)/);
          if (spotifyMatch) {
            var spotifyType = spotifyMatch[1];
            var spotifyId = spotifyMatch[2];
            var embedUrl = 'https://open.spotify.com/embed/' + spotifyType + '/' + spotifyId + '?utm_source=generator';
            var iframe = document.createElement('iframe');
            iframe.style.display = 'block';
            iframe.style.width = '100%';
            iframe.style.maxWidth = '600px';
            iframe.style.height = '80px';
            iframe.style.border = '0';
            iframe.style.borderRadius = '12px';
            iframe.style.margin = '0 auto';
            iframe.allow = 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture';
            iframe.loading = 'lazy';
            iframe.title = 'Spotify ' + spotifyType;
            iframe.src = embedUrl;
            songWrap.style.display = 'block';
            songWrap.innerHTML = '';
            songWrap.appendChild(iframe);
          } else {
            songWrap.style.display = 'block';
            songWrap.innerHTML = '';
            var audio = document.createElement('audio');
            audio.controls = true;
            audio.preload = 'metadata';
            audio.style.width = '100%';
            audio.style.maxWidth = '400px';
            audio.style.height = '40px';
            var src = document.createElement('source');
            src.src = url;
            src.type = 'audio/mpeg';
            audio.appendChild(src);
            songWrap.appendChild(audio);
          }
        } else {
          songWrap.style.display = 'none';
        }

        linksEl.innerHTML = '';
        var links = Array.isArray(data.links) ? data.links : [];
        links.forEach(function(l) {
          if (!l.url) return;
          var a = document.createElement('a');
          a.href = l.url;
          a.target = '_blank';
          a.rel = 'noopener';
          a.className = 'bio-link-btn' + (l.iconOnly ? ' bio-link-icon-only' : '');
          a.setAttribute('data-tooltip', l.iconOnly ? (l.label || l.url) : '');
          var iconKey = (l.icon && l.icon.trim()) ? l.icon.trim() : 'link';
          var iconSpan = document.createElement('span');
          iconSpan.className = 'bio-link-icon';
          iconSpan.setAttribute('aria-hidden', 'true');
          var svg = (window.LINK_ICON_SVG && window.LINK_ICON_SVG[iconKey]) ? window.LINK_ICON_SVG[iconKey] : (window.LINK_ICON_SVG && window.LINK_ICON_SVG.link) ? window.LINK_ICON_SVG.link : '';
          if (svg) {
            iconSpan.innerHTML = svg;
          } else {
            iconSpan.textContent = '\u27A4';
          }
          a.appendChild(iconSpan);
          var labelSpan = document.createElement('span');
          labelSpan.className = 'bio-link-label';
          labelSpan.textContent = l.label || l.url;
          if (l.iconOnly) labelSpan.style.display = 'none';
          a.appendChild(labelSpan);
          linksEl.appendChild(a);
        });

        var footer = document.querySelector('.bio-footer');
        if (footer) footer.style.display = (premium && data.premiumHideBranding) ? 'none' : '';

        var customCssEl = document.getElementById('bioPremiumCustomCSS');
        if (customCssEl) customCssEl.remove();
        if (premium && data.premiumCustomCSS && data.premiumCustomCSS.trim()) {
          var styleEl = document.createElement('style');
          styleEl.id = 'bioPremiumCustomCSS';
          styleEl.textContent = data.premiumCustomCSS.trim();
          document.head.appendChild(styleEl);
        }
      }

      if (!username || !username.trim()) {
        showNotFound();
        return;
      }

      showLoading();
      getBioByUsername(username.trim()).then(function(data) {
        if (!data) {
          showNotFound();
          return;
        }
        if (data.redirect) {
          window.location.replace('/' + encodeURIComponent(data.redirect));
          return;
        }
        showBio(data);
      }).catch(function() {
        showNotFound();
      });
    })();
  </script>
</body>
</html>
